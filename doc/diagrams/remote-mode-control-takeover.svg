<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700" viewBox="0 0 1200 700">
  <defs>
    <style>
      .title{font:700 28px system-ui,Segoe UI,Roboto,Arial,sans-serif;fill:#111;}
      .h{font:700 18px system-ui,Segoe UI,Roboto,Arial,sans-serif;fill:#111;}
      .t{font:400 16px system-ui,Segoe UI,Roboto,Arial,sans-serif;fill:#111;}
      .muted{font:400 14px system-ui,Segoe UI,Roboto,Arial,sans-serif;fill:#444;}
      .box{fill:#fff;stroke:#111;stroke-width:2;rx:12;}
      .step{fill:#fff;stroke:#111;stroke-width:2;rx:12;}
      .lane{fill:#f7f7f7;stroke:#bbb;stroke-width:2;rx:18;}
      .arrow{stroke:#111;stroke-width:3;fill:none;marker-end:url(#m);} 
      .darrow{stroke:#111;stroke-width:3;fill:none;stroke-dasharray:7 7;marker-end:url(#m);} 
    </style>
    <marker id="m" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#111" />
    </marker>
  </defs>

  <text x="40" y="55" class="title">Control takeover flow (remote connects)</text>
  <text x="40" y="90" class="muted">Target temporarily stops its local UI and exposes hardware to the remote controller.</text>

  <!-- Lanes -->
  <rect x="40" y="130" width="520" height="520" class="lane"/>
  <rect x="640" y="130" width="520" height="520" class="lane"/>
  <text x="60" y="165" class="h">Remote system (remote-mode)</text>
  <text x="660" y="165" class="h">Kittyflap target (target-mode)</text>

  <!-- Remote steps -->
  <rect x="80" y="210" width="440" height="80" class="step"/>
  <text x="100" y="242" class="t">1) Start Kittyhack UI + backend</text>
  <text x="100" y="268" class="muted">Browser connects to remote UI (HTTP :80)</text>

  <rect x="80" y="320" width="440" height="90" class="step"/>
  <text x="100" y="352" class="t">2) Connect to kittyhack_control</text>
  <text x="100" y="378" class="muted">WebSocket to target :8888</text>

  <rect x="80" y="440" width="440" height="90" class="step"/>
  <text x="100" y="472" class="t">3) Send take_control + keepalives</text>
  <text x="100" y="498" class="muted">Ping regularly to avoid timeout</text>

  <rect x="80" y="560" width="440" height="70" class="step"/>
  <text x="100" y="600" class="t">4) Use remote sensors/actors</text>

  <!-- Target steps -->
  <rect x="680" y="320" width="440" height="90" class="step"/>
  <text x="700" y="352" class="t">A) Accept controller (if idle)</text>
  <text x="700" y="378" class="muted">Denies if already controlled</text>

  <rect x="680" y="440" width="440" height="90" class="step"/>
  <text x="700" y="472" class="t">B) Stop kittyhack.service</text>
  <text x="700" y="498" class="muted">Serve info page on :80 while controlled</text>

  <rect x="680" y="560" width="440" height="70" class="step"/>
  <text x="700" y="600" class="t">C) Stream state + execute commands</text>

  <!-- Arrows between lanes -->
  <path d="M 520 365 C 570 365, 590 365, 640 365" class="arrow"/>
  <text x="535" y="345" class="muted">take_control</text>

  <path d="M 640 595 C 590 595, 570 595, 520 595" class="darrow"/>
  <text x="535" y="620" class="muted">state stream</text>

  <path d="M 520 485 C 570 485, 590 485, 640 485" class="darrow"/>
  <text x="535" y="510" class="muted">keepalive ping</text>
</svg>
